<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAPTCHA</title>
</head>
<body>

    <img id="captchaImage" />
    <br>
    <input type="text" id="captchaAnswer" placeholder="Enter Captcha">
    <button onclick="validate()">Validate</button>
    <button onclick="regen()">Regenerate</button>
  
    <script>
      let captchaId;
      document.getElementById('captchaAnswer').value = ""
      function req() {
        document.getElementById('captchaAnswer').value = ""
        fetch('/api/captcha/request')
          .then(response => {
            if (response.status === 429) {
        alert('You are being rate limited. Please press Regenerate in a few minutes');
        document.getElementById('captchaImage').style.display = 'none'; 
        throw new Error('Rate Limited');
      }
            return response.text()

        })
          .then(id => {

            document.getElementById('captchaImage').src = `/api/captcha/${id}/image.gif`;
            document.getElementById('captchaImage').style.display = 'block';
          });
      }
  
      function validate() {
        const captchaAnswer = document.getElementById('captchaAnswer').value;
        fetch(`/api/captcha/${captchaId}/validate`, {
          method: 'POST',
          headers: {
            'Content-Type': 'text/plain',
          },
          body: captchaAnswer,
        })
          .then(response => response.text())
          .then(result => {
            if (result) {
              console.log('Captcha passed!');
            } else {
              console.log('Captcha failed!');
              requestCaptcha();
            }
          });
      }
  
      function regen() {
        document.getElementById('captchaAnswer').value = ""
        fetch(`/api/captcha/${captchaId}/void`)
          .then(() => 
          {
            if (response.status === 429) {
        alert('You are being rate limited. Please press Regenerate in a few minutes');
        document.getElementById('captchaImage').style.display = 'none'; 
        throw new Error('Rate Limited');
      } else {req()}
      
    
          });
      }
  
      // Call req when the page loads
      req();
    </script>
</body>
</html>